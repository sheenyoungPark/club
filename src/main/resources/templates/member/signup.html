<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>íšŒì›ê°€ì…</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: 'Malgun Gothic', sans-serif;
      background-color: #1a0067;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .signup-container {
      background-color: white;
      border-radius: 10px;
      padding: 40px;
      width: 450px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    h1 {
      text-align: center;
      font-size: 24px;
      margin-bottom: 30px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .required-field::after {
      content: " *";
      color: red;
      font-weight: bold;
    }

    .input-field {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
      font-size: 14px;
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .check-button {
      background-color: #1f0068;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 10px;
      white-space: nowrap;
    }

    .verify-button {
      background-color: #1f0068;
      color: white;
      border: none;
      border-radius: 5px;
      padding: 10px 15px;
      cursor: pointer;
      font-size: 13px;
      white-space: nowrap;
    }

    .address-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .address-row {
      display: flex;
      gap: 10px;
    }

    .address-input {
      flex: 1;
    }

    .hr-line {
      border-top: 1px solid #eee;
      margin: 20px 0;
    }

    .consent-section {
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
    }

    .consent-description {
      font-size: 12px;
      color: #666;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .checkbox-item {
      display: flex;
      align-items: flex-start;
      margin-bottom: 8px;
    }

    .checkbox-item input {
      margin-top: 3px;
      margin-right: 8px;
    }

    .checkbox-label {
      font-size: 13px;
      color: #333;
    }

    .submit-button {
      width: 100%;
      padding: 15px;
      background-color: white;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 20px;
    }

    .submit-button:hover {
      background-color: #f8f8f8;
    }

    /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .error-message {
      color: red;
      font-size: 12px;
      display: block;
      margin-top: 5px;
      margin-left: 2px;
    }

    .success-message {
      color: green;
      font-size: 12px;
    }

    /* í•„ìˆ˜ í•­ëª© ì„¤ëª… ìŠ¤íƒ€ì¼ */
    .required-field-notice {
      font-size: 12px;
      color: #666;
      margin-bottom: 20px;
      text-align: right;
    }

    .required-field-notice span {
      color: red;
      font-weight: bold;
    }
  </style>
  <script
          src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script
          src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
  <script
          src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
  <script
          src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
</head>
<body>
<script type="text/javascript">
  function checkMemberId() {
    let member_id = $("#member_id").val().trim();

    if (member_id.length < 5 || member_id.length > 40) {
      $("#member_id_error")
              .removeClass("success-message")
              .addClass("error-message")
              .text("ì•„ì´ë””ëŠ” 5~40ì ì‚¬ì´ë¡œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.")
              .show();
      return;
    }

    $.ajax({
      url: /*[[ @{/member/checkId} ]]*/ + "?member_id=" + encodeURIComponent(member_id),
      type: "get",
      dataType: "text",
      success: function(result) {
        if (result === "true") {
          $("#member_id_error")
                  .removeClass("error-message")
                  .addClass("success-message")
                  .text("ì‚¬ìš© ê°€ëŠ¥í•œ ì•„ì´ë””ì…ë‹ˆë‹¤.")
                  .show();
          $("#idExist").val("true");
        } else {
          $("#member_id_error")
                  .removeClass("success-message")
                  .addClass("error-message")
                  .text("ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.")
                  .show();
          $("#idExist").val("false");
        }
      },
      error: function() {
        $("#member_id_error")
                .removeClass("success-message")
                .addClass("error-message")
                .text("ì¤‘ë³µí™•ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")
                .show();
      }
    });
  }

  function resetMemberId() {
    $("#idExist").val("false");
    $("#member_id_error").text("").hide();
  }

  // ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ í•¨ìˆ˜
  function checkMemberNickname() {
    let member_nickname = $("#member_nickname").val().trim();

    if (member_nickname.length === 0) {
      $("#member_nickname_error").removeClass("success-message")
              .addClass("error-message").text("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.").show();
      return;
    }

    $.ajax({
      url : /*[[ @{/member/checkNickname} ]]*/ + "?member_nickname=" + encodeURIComponent(member_nickname),
      type : "get",
      dataType : "text",
      success : function(result) {
        if (result === "true") {
          $("#member_nickname_error")
                  .removeClass("error-message")
                  .addClass("success-message")
                  .text("ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.").show();
          $("#nickExist").val("true");
        } else {
          $("#member_nickname_error")
                  .removeClass("success-message")
                  .addClass("error-message")
                  .text("ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.").show();
          $("#nickExist").val("false");
        }
      },
      error : function() {
        $("#member_nickname_error")
                .removeClass("success-message")
                .addClass("error-message")
                .text("ì¤‘ë³µí™•ì¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.").show();
      }
    });
  }


  function resetMemberNickname() {
    $("#nickExist").val("false");
    $("#member_nickname_error").text("").hide();
  }

  function validateSignup() {
    // í•„ìˆ˜ ë™ì˜ í•­ëª© í™•ì¸
    let allRequiredChecked = true;

    $(".consent-section input[type='checkbox']").each(function() {
      if ($(this).next("label").text().includes("(í•„ìˆ˜)") && !$(this).prop("checked")) {
        allRequiredChecked = false;
      }
    });

    if (!allRequiredChecked) {
      alert("í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì•¼ íšŒì›ê°€ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return false;
    }

    if ($("#idExist").val() !== "true") {
      alert("ì•„ì´ë”” ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”.");
      return false;
    }
    if ($("#nickExist").val() !== "true") {
      alert("ë‹‰ë„¤ì„ ì¤‘ë³µí™•ì¸ì„ í•´ì£¼ì„¸ìš”.");
      return false;
    }

    if ($("#member_postcode").val() === "" || $("#member_address").val() === "") {
      alert("ì£¼ì†Œ ê²€ìƒ‰ì„ í†µí•´ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return false;
    }

    return true;
  }

  function resetMemberId() {
    $("#idExist").val("false");
    $("#member_id_error").text("").hide();
  }

  function resetMemberNickname() {
    $("#nickExist").val("false");
    $("#member_nickname_error").text("").hide();
  }

  // ì£¼ì†Œ ê²€ìƒ‰ í•¨ìˆ˜
  function searchAddress() {
    new daum.Postcode({
      oncomplete: function(data) {
        var roadAddr = data.roadAddress;
        var jibunAddr = data.jibunAddress;

        document.getElementById('member_postcode').value = data.zonecode;
        document.getElementById('member_address').value = roadAddr || jibunAddr;

        document.getElementById("member_address_detail").focus();
      }
    }).open();
  }
</script>

<div class="signup-container">
  <h1>íšŒì›ê°€ì…</h1>

  <div class="required-field-notice">
    <span>*</span> í‘œì‹œëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.
  </div>

  <form th:action="@{/member/signup_pro}" method="post" th:object="${memberBean}" onsubmit="return validateSignup();" >
    <div class="form-group">
      <form path="member_id" cssClass="required-field">ì•„ì´ë””</form>
      <div class="input-row">
        <input type="text" id="member_id" th:field="*{member_id}" class="input-field" oninput="resetMemberId()" placeholder="5~40ìë¦¬" />
        <button type="button" class="check-button" onclick="checkMemberId()">ì¤‘ë³µí™•ì¸</button>
      </div>
      <input type="hidden" id="idExist" name="idExist" value="false" /> <span
            id="member_id_error" class="error-message"></span>
    </div>

    <div class="form-group">
      <label for="member_pw" class="required-field">ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="member_pw" th:field="*{member_pw}" class="input-field" placeholder="8~16ìë¦¬" />
      <span class="error-message" th:if="${#fields.hasErrors('member_pw')}" th:errors="*{member_pw}" />
    </div>

    <div class="form-group">
      <label for="member_pw2" class="required-field">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
      <input type="password" id="member_pw2" th:field="*{member_pw2}"
             class="input-field" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" />
      <span class="error-message" th:if="${#fields.hasErrors('member_pw2')}" th:errors="*{member_pw2}"></span>
    </div>

    <div class="form-group">
      <label for="member_name" class="required-field">ì´ë¦„</label>
      <input type="text" id="member_name" th:field="*{member_name}"
             class="input-field" placeholder="2~10ìë¦¬" />
      <span class="error-message" th:if="${#fields.hasErrors('member_name')}" th:errors="*{member_name}"></span>
    </div>
    <div class="form-group">
      <label for="member_nickname" class="required-field">ë‹‰ë„¤ì„</label>
      <div class="input-row">
        <input type="text" id="member_nickname" th:field="*{member_nickname}"
               class="input-field" oninput="resetMemberNickname()"
               placeholder="ìµœëŒ€ 8ìë¦¬" />
        <button type="button" class="check-button" onclick="checkMemberNickname()">ì¤‘ë³µí™•ì¸</button>
      </div>
      <input type="hidden" id="nickExist" name="nickExist" value="false" />
      <span id="member_nickname_error" class="error-message"></span>
    </div>

    <div class="form-group">
      <label for="member_phone" class="required-field">íœ´ëŒ€í°</label>
      <div class="input-row">
        <input type="text" id="member_phone" th:field="*{member_phone}"
               class="input-field" placeholder="- ì—†ì´ ì…ë ¥" />
        <button type="button" class="check-button" id="sendAuthCode">ì¸ì¦ìš”ì²­</button>
      </div>
      <span class="error-message" th:if="${#fields.hasErrors('member_phone')}" th:errors="*{member_phone}"></span>
      <span id="phoneAuthMessage" class="error-message"></span>
    </div>

    <div class="form-group" id="authCodeContainer" style="display: none;">
      <label for="authCode">ì¸ì¦ë²ˆí˜¸ ì…ë ¥</label>
      <div class="input-row">
        <input type="text" id="authCode" class="input-field" placeholder="ì¸ì¦ë²ˆí˜¸ ì…ë ¥">
        <button type="button" class="check-button" id="verifyAuthCode">í™•ì¸</button>
      </div>
      <span id="authResult"></span>
    </div>

    <div class="form-group">
      <label for="member_address" class="required-field">ì£¼ì†Œ</label>
      <div class="address-container">
        <div class="address-row">
          <input type="text" id="member_postcode" class="input-field" placeholder="ìš°í¸ë²ˆí˜¸" readonly />
          <button type="button" class="check-button" onclick="searchAddress()">ì£¼ì†Œê²€ìƒ‰</button>
        </div>
        <input type="text" id="member_address" th:field="*{member_address}"
               class="input-field" placeholder="ê¸°ë³¸ì£¼ì†Œ" readonly="true" />
        <input type="text" id="member_address_detail" class="input-field" name="member_address_detail"
               placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥" />
      </div>
      <span class="error-message" th:if="${#fields.hasErrors('member_address')}" th:errors="*{member_address}"></span>
    </div>

    <div class="form-group">
      <label for="member_email" class="required-field">ì´ë©”ì¼</label>
      <input type="email" id="member_email" th:field="*{member_email}"
             class="input-field" placeholder="email@ujoodong.com" />
      <span class="error-message" th:if="${#fields.hasErrors('member_email')}" th:errors="*{member_email}"></span>
    </div>

    <div class="form-group">
      <label>ì•½ê´€</label>
      <div class="consent-section">
        <div class="checkbox-item">
          <input type="checkbox" id="all_consent" name="all_consent">
          <label for="all_consent" class="checkbox-label">ì „ì²´ ë™ì˜</label>
        </div>

        <div class="hr-line"></div>
        <p class="consent-description">ì „ììƒê±°ë˜ ì´ìš©ì— í•„ìš”í•œ í•„ìˆ˜ì ì¸ ê°œì¸ì •ë³´ì™€ ì„ íƒì •ë³´ì— ëŒ€í•œ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</p>

        <div class="checkbox-item">
          <input type="checkbox" id="terms" name="terms">
          <label for="terms" class="checkbox-label">(í•„ìˆ˜) ê°œì¸ì •ë³´ ì´ìš©ì•½ê´€ ë™ì˜</label>
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="personal_info" name="personal_info">
          <label for="personal_info" class="checkbox-label">(í•„ìˆ˜) ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜</label>
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="location_info" name="location_info">
          <label for="location_info" class="checkbox-label">(ì„ íƒ) ìœ„ì¹˜ê¸°ë°˜ì„œë¹„ìŠ¤ ì´ìš©ì•½ê´€ì— ë™ì˜</label>
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="marketing_email" name="marketing_email">
          <label for="marketing_email" class="checkbox-label">(ì„ íƒ) ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹  ë™ì˜</label>
        </div>

        <div class="checkbox-item">
          <input type="checkbox" id="marketing_sms" name="marketing_sms">
          <label for="marketing_sms" class="checkbox-label">(ì„ íƒ) ë§ˆì¼€íŒ… ì •ë³´ ìˆ˜ì‹ ë™ì˜ : SMS/MMS ë™ì˜</label>
        </div>
      </div>
    </div>
    <button type="submit" class="submit-button">íšŒì›ê°€ì… ì™„ë£Œ</button>
  </form>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    // Thymeleafì—ì„œ ì»¨í…ìŠ¤íŠ¸ ê²½ë¡œë¥¼ JavaScript ë³€ìˆ˜ë¡œ ë¯¸ë¦¬ ì €ì¥
    let sendCodeUrl = /*[[ @{/auth/sendCode} ]]*/ '';
    let verifyCodeUrl = /*[[ @{/auth/verifyCode} ]]*/ '';

    $("#sendAuthCode").click(function() {
      let phoneNumber = "+82" + $("#member_phone").val().trim();

      if (phoneNumber.length === 0) {
        alert("íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      let sendCodeUrl = /*[[ @{/auth/sendCode} ]]*/ '';

      console.log("ì¸ì¦ë²ˆí˜¸ ìš”ì²­: " + sendCodeUrl + " | phoneNumber: " + phoneNumber);

      $.ajax({
        url: sendCodeUrl,
        type: "POST",  // ğŸ”¹ ë°˜ë“œì‹œ "POST" ìš”ì²­ìœ¼ë¡œ ì„¤ì •
        contentType: "application/x-www-form-urlencoded; charset=UTF-8", // Springì—ì„œ ì¸ì‹ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
        data: { phoneNumber: phoneNumber },
        success: function(response) {
          console.log("ì‘ë‹µ: " + response);
          alert(response);
          $("#authCodeContainer").show();
        },
        error: function(xhr) {
          console.log("ì˜¤ë¥˜ ìƒíƒœ ì½”ë“œ: " + xhr.status);
          console.log("ì˜¤ë¥˜ ë©”ì‹œì§€: " + xhr.responseText);
          alert("ì¸ì¦ë²ˆí˜¸ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒíƒœ ì½”ë“œ: " + xhr.status);
        }
      });
    });

    $("#verifyAuthCode").click(function() {
      let phoneNumber = "+82" + $("#member_phone").val().trim();
      let authCode = $("#authCode").val().trim();

      if (authCode.length === 0) {
        alert("ì¸ì¦ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      // ì„œë²„ì— ì¸ì¦ë²ˆí˜¸ ê²€ì¦ ìš”ì²­
      $.post(verifyCodeUrl, { phoneNumber: phoneNumber, authCode: authCode }, function(response) {
        if (response) {
          $("#authResult").text("âœ” ì¸ì¦ ì„±ê³µ").css({"color": "green", "font-size": "10px"});
          $("#member_phone").prop("readonly", true).css({"color": "gray"});
        } else {
          $("#authResult").text("âŒ ì¸ì¦ ì‹¤íŒ¨").css({"color": "red", "font-size": "10px"});
        }
      }).fail(function() {
        alert("ì¸ì¦ë²ˆí˜¸ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      });
    });
  });
</script>
</body>
</html>