<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 정보</title>
    <link rel="stylesheet" th:href="@{/css/memberinfo.css}">
    <link rel="stylesheet" th:href="@{/css/bottom.css}">
    <link rel="stylesheet" th:href="@{/css/top.css}">
</head>
<body>
<div th:insert="~{include/top_search :: top_search}"></div>
<div class="container">
    <h2>내 정보</h2>

    <!-- 프로필 섹션 -->
    <div class="profile-section">
        <!-- ✅ 프로필 이미지 표시 (기본 or 사용자 설정) -->
        <div class="profile-image">
            <img th:src="${loginMember.member_profile != null and loginMember.member_profile != ''}
                        ? @{/image/profile/{img}(img=${loginMember.member_profile})}
                        : @{/sources/picture/기본이미지.png}"
                 id="profilePreview" alt="프로필 이미지">
        </div>

        <!-- ✅ 프로필 이미지 변경 -->
        <form th:action="@{/member/updateProfile}" method="post" enctype="multipart/form-data">
            <input type="file" id="profileUpload" name="profileImage" accept="image/*" class="input-file">
            <button type="submit" class="button">프로필 변경</button>
        </form>

        <div class="profile-name">이름 : <span th:text="${loginMember.member_name}"></span></div>
        <div class="profile-nickname">닉네임 : <span th:text="${loginMember.member_nickname}"></span></div>
        <div class="profile-phone">휴대폰 : <span th:text="${maskedPhone}"></span></div>
        <div class="profile-email">이메일 : <span th:text="${loginMember.member_email}"></span></div>
        <div class="profile-address">주소 : <span th:text="${loginMember.member_address}"></span></div>
    </div>

    <div class="section-divider"></div>

    <!-- 정보 수정 페이지 이동 버튼 -->
    <div class="extra-actions">
        <!-- 기존 두 버튼을 하나로 통합 -->
        <a th:href="@{/member/edit}" class="button">회원정보 관리</a>
        <a th:href="@{/member/deleteAccount}" class="button danger">회원 탈퇴</a>
    </div>
</div>

<script>
    document.getElementById('profileUpload').addEventListener('change', function(event) {
        const preview = document.getElementById('profilePreview');
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });
</script>

<div th:replace="~{include/bottom_info :: bottom_info}"></div>
</body>
</html>
