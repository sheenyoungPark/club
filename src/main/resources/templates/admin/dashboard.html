<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>관리자 대시보드</title>
  <link rel="stylesheet" th:href="@{/css/adminDashBoard.css}">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    .sidebar {
      height: 100vh;
      background-color: #343a40;
      color: white;
    }
    .sidebar a {
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      display: block;
      padding: 10px 15px;
    }
    .sidebar a:hover {
      color: white;
      background-color: #495057;
    }
    .sidebar a.active {
      background-color: #0d6efd;
      color: white;
    }
    .stat-card {
      transition: transform 0.3s;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }
    .dashboard-icon {
      font-size: 2rem;
      opacity: 0.8;
    }
    .chart-container {
      height: 250px; /* 차트 높이 줄임 */
    }
    .main-content {
      height: 100vh;
      overflow-y: auto;
    }
    /* 카드 크기와 패딩 조정 */
    .card-body {
      padding: 0.75rem;
    }
    .mb-4 {
      margin-bottom: 1rem !important;
    }
  </style>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- 사이드바 메뉴 -->
    <div class="col-md-2 sidebar p-0">
      <div class="d-flex flex-column flex-shrink-0 p-3">
        <a href="/admin/dashboard" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-decoration-none">
          <span class="fs-4">관리자 패널</span>
        </a>
        <hr>
        <ul class="nav nav-pills flex-column mb-auto">
          <li class="nav-item">
            <a href="/admin/dashboard" class="nav-link active">
              대시보드
            </a>
          </li>
          <li>
            <a href="/admin/club_management" class="nav-link">
              동호회 관리
            </a>
          </li>
          <li>
            <a href="/admin/business_management" class="nav-link">
              판매자 관리
            </a>
          </li>
          <li>
            <a href="/admin/member_management" class="nav-link">
              회원 관리
            </a>
          </li>
          <li>
            <a href="/admin/board_management" class="nav-link">
              게시판 관리
            </a>
          </li>
          <li>
            <a href="/admin/exchange_management" class="nav-link">
              포인트 관리
            </a>
          </li>
        </ul>
        <hr>
        <div>
          <a href="/member/logout" class="btn btn-danger w-100">로그아웃</a>
        </div>
      </div>
    </div>

    <!-- 메인 콘텐츠 -->
    <div class="col-md-10 p-3 main-content">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>대시보드</h2>
        <div class="text-muted">최근 업데이트: <span id="lastUpdate">로딩 중...</span></div>
      </div>

      <!-- 통계 카드 -->
      <div class="row mb-3">
        <div class="col-md-3">
          <div class="card stat-card bg-primary text-white">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <div class="fs-5">전체 회원</div>
                <div class="fs-2 fw-bold">265</div>
              </div>
              <div class="dashboard-icon">
                <i class="fas fa-users"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center p-2">
              <small>전월 대비 <span class="fw-bold">+12.5%</span></small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card bg-success text-white">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <div class="fs-5">동호회</div>
                <div class="fs-2 fw-bold">47</div>
              </div>
              <div class="dashboard-icon">
                <i class="fas fa-building-user"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center p-2">
              <small>전월 대비 <span class="fw-bold">+5.2%</span></small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card bg-warning text-dark">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <div class="fs-5">승인대기</div>
                <div class="fs-2 fw-bold">8</div>
              </div>
              <div class="dashboard-icon">
                <i class="fas fa-clock"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center p-2">
              <small>오늘 신규 <span class="fw-bold">3건</span></small>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card stat-card bg-danger text-white">
            <div class="card-body d-flex justify-content-between align-items-center">
              <div>
                <div class="fs-5">오늘 방문자</div>
                <div class="fs-2 fw-bold">142</div>
              </div>
              <div class="dashboard-icon">
                <i class="fas fa-chart-line"></i>
              </div>
            </div>
            <div class="card-footer d-flex align-items-center p-2">
              <small>전일 대비 <span class="fw-bold">+8.1%</span></small>
            </div>
          </div>
        </div>
      </div>

      <!-- 최근 활동 및 승인 대기 목록 -->
      <div class="row">
        <!-- 최근 활동 -->
        <div class="col-md-6 mb-3">
          <div class="card h-100">
            <div class="card-header py-2 d-flex justify-content-between align-items-center">
              <h5 class="mb-0">최근 활동</h5>
              <a href="#" class="btn btn-sm btn-outline-primary">모두 보기</a>
            </div>
            <div class="card-body p-0">
              <ul class="list-group list-group-flush">
                <li class="list-group-item d-flex justify-content-between align-items-center py-2">
                  <div>
                    <div class="fw-bold">새로운 동호회 생성</div>
                    <div class="small text-muted">작성자: 김철수 | 2023-08-11 13:45</div>
                  </div>
                  <span class="badge bg-primary rounded-pill">New</span>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center py-2">
                  <div>
                    <div class="fw-bold">회원 가입</div>
                    <div class="small text-muted">사용자: 이영희 | 2023-08-11 11:22</div>
                  </div>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center py-2">
                  <div>
                    <div class="fw-bold">동호회 가입 요청</div>
                    <div class="small text-muted">사용자: 박민수 | 2023-08-10 17:35</div>
                  </div>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center py-2">
                  <div>
                    <div class="fw-bold">게시글 등록</div>
                    <div class="small text-muted">작성자: 최지원 | 2023-08-10 15:10</div>
                  </div>
                </li>
                <li class="list-group-item d-flex justify-content-between align-items-center py-2">
                  <div>
                    <div class="fw-bold">동호회 상태 변경</div>
                    <div class="small text-muted">관리자: 시스템 | 2023-08-10 10:05</div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- 승인 대기 목록 -->
        <div class="col-md-6 mb-3">
          <div class="card h-100">
            <div class="card-header py-2 d-flex justify-content-between align-items-center">
              <h5 class="mb-0">승인 대기 목록</h5>
              <a href="/admin/club_management" class="btn btn-sm btn-outline-primary">관리 페이지로</a>
            </div>
            <div class="card-body p-0">
              <table class="table table-hover mb-0">
                <thead>
                <tr>
                  <th>동호회명</th>
                  <th>신청자</th>
                  <th>신청일</th>
                  <th>조치</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                  <td>프로그래밍 스터디</td>
                  <td>김철수</td>
                  <td>2023-08-11</td>
                  <td>
                    <button class="btn btn-sm btn-success">승인</button>
                    <button class="btn btn-sm btn-secondary">상세</button>
                  </td>
                </tr>
                <tr>
                  <td>등산 모임</td>
                  <td>박민수</td>
                  <td>2023-08-10</td>
                  <td>
                    <button class="btn btn-sm btn-success">승인</button>
                    <button class="btn btn-sm btn-secondary">상세</button>
                  </td>
                </tr>
                <tr>
                  <td>영화 감상 동호회</td>
                  <td>이영희</td>
                  <td>2023-08-10</td>
                  <td>
                    <button class="btn btn-sm btn-success">승인</button>
                    <button class="btn btn-sm btn-secondary">상세</button>
                  </td>
                </tr>
                <tr>
                  <td>독서 모임</td>
                  <td>최지원</td>
                  <td>2023-08-09</td>
                  <td>
                    <button class="btn btn-sm btn-success">승인</button>
                    <button class="btn btn-sm btn-secondary">상세</button>
                  </td>
                </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- 그래프 및 차트 -->
      <div class="row">
        <div class="col-md-8 mb-3">
          <div class="card">
            <div class="card-header py-2">
              <h5 class="mb-0">회원 가입 추이</h5>
            </div>
            <div class="card-body">
              <div class="chart-container">
                <canvas id="membershipChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="card">
            <div class="card-header py-2">
              <h5 class="mb-0">동호회 카테고리 분포</h5>
            </div>
            <div class="card-body">
              <div class="chart-container" style="height: 220px;"> <!-- 도넛 차트 높이 더 줄임 -->
                <canvas id="clubCategoryChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.0/chart.min.js"></script>
<script>
  // 현재 시간 표시
  function updateTime() {
    const now = new Date();
    const formattedDate = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')}`;
    document.getElementById('lastUpdate').textContent = formattedDate;
  }

  // 회원 가입 추이 차트
  function initMembershipChart() {
    const ctx = document.getElementById('membershipChart').getContext('2d');
    const membershipChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: ['1월', '2월', '3월', '4월', '5월', '6월', '7월', '8월'],
        datasets: [{
          label: '신규 회원',
          data: [12, 19, 15, 17, 22, 28, 32, 35],
          borderColor: 'rgb(13, 110, 253)',
          backgroundColor: 'rgba(13, 110, 253, 0.1)',
          tension: 0.3,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
          },
          title: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  // 동호회 카테고리 분포 차트
  function initClubCategoryChart() {
    const ctx = document.getElementById('clubCategoryChart').getContext('2d');
    const clubCategoryChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['스포츠', '학습', '취미', '문화/예술', '기타'],
        datasets: [{
          label: '동호회 카테고리',
          data: [18, 12, 9, 5, 3],
          backgroundColor: [
            'rgba(54, 162, 235, 0.8)',
            'rgba(75, 192, 192, 0.8)',
            'rgba(255, 206, 86, 0.8)',
            'rgba(153, 102, 255, 0.8)',
            'rgba(201, 203, 207, 0.8)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right',
            labels: {
              boxWidth: 10,
              font: {
                size: 10
              }
            }
          }
        }
      }
    });
  }

  // DOM이 로드되면 실행
  document.addEventListener('DOMContentLoaded', function() {
    // 현재 시간 표시 및 업데이트
    updateTime();
    setInterval(updateTime, 1000);

    // 차트 초기화
    initMembershipChart();
    initClubCategoryChart();

    // 승인 버튼 이벤트
    document.querySelectorAll('.btn-success').forEach(button => {
      button.addEventListener('click', function() {
        const row = this.closest('tr');
        const clubName = row.querySelector('td:first-child').textContent;

        if (confirm(`"${clubName}" 동호회를 승인하시겠습니까?`)) {
          // AJAX 요청을 통한 동호회 승인 처리
          alert(`"${clubName}" 동호회가 승인되었습니다.`);
          row.remove();

          // 승인 대기 카운트 업데이트
          const waitCount = document.querySelectorAll('tbody tr').length;
          document.querySelector('.stat-card:nth-child(3) .fs-2').textContent = waitCount;
        }
      });
    });
  });
</script>
</body>
</html>