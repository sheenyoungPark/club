<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>우주동 채팅</title>

  <link rel="stylesheet" th:href="@{/css/chat.css}">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>


<div class="chat-container">
  <!-- 왼쪽 패널 - 채팅방 목록 -->
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <h2>채팅</h2>
      <button id="newChatBtn" class="new-chat-btn">
        <i class="fas fa-plus"></i> 새 채팅
      </button>
    </div>

    <!-- 채팅방 유형 선택 탭 -->
    <div class="chat-tabs">
      <button class="tab-btn active" data-tab="all">전체</button>
      <button class="tab-btn" data-tab="PERSONAL">개인</button>
      <button class="tab-btn" data-tab="CLUB">동호회</button>
    </div>

    <!-- 검색 필드 -->
    <div class="search-input-container">
      <input type="text" id="searchChatInput" placeholder="대화방 검색">
      <i class="fas fa-search"></i>
    </div>

    <!-- 채팅방 목록 -->
    <ul class="chat-room-list" id="chatRoomList">
      <li th:each="room : ${chatRooms}"
          th:id="'room-' + ${room.id}"
          th:class="'chat-room-item' + (${room.unreadCount > 0 ? ' unread' : '')}"
          th:data-room-id="${room.id}"
          th:data-room-type="${room.roomType}">

        <div class="chat-room-avatar">
          <!-- 채팅방 유형에 따라 다른 아이콘 표시 -->
          <i th:class="${room.roomType == 'PERSONAL' ? 'fas fa-user' : 'fas fa-users'}"></i>
        </div>

        <div class="chat-room-info">
          <h3 class="chat-room-name" th:text="${room.roomName}">채팅방 이름</h3>
          <p class="chat-room-last-message" th:text="${room.lastMessage}">마지막 메시지...</p>
        </div>

        <div class="chat-room-meta">
          <span class="chat-room-time" th:text="${#temporals.format(room.lastMessageTime, 'HH:mm')}">12:34</span>
          <!-- 안 읽은 메시지가 있으면 표시 -->
          <span th:if="${room.unreadCount > 0}" class="chat-room-badge" th:text="${room.unreadCount}">2</span>
        </div>
      </li>
      <li class="no-chats" th:if="${#lists.isEmpty(chatRooms)}">
        채팅방이 없습니다. 새 채팅을 시작해보세요.
      </li>
    </ul>
  </div>

  <!-- 오른쪽 패널 - 채팅 메시지 영역 -->
  <div class="chat-content">
    <!-- 채팅방 선택 전 안내 메시지 -->
    <div id="chatPlaceholder" class="chat-placeholder">
      <div class="placeholder-content">
        <i class="fas fa-comments"></i>
        <h2>채팅방을 선택하세요</h2>
        <p>왼쪽의 채팅방 목록에서 대화할 방을 선택하거나, 새 채팅을 시작하세요.</p>
      </div>
    </div>

    <!-- 실제 채팅방 화면 (처음에는 숨김) -->
    <div id="chatRoom" class="chat-room-container" style="display: none;">
      <!-- 채팅방 헤더 -->
      <div class="chat-room-header">
        <div id="chatRoomInfo" class="chat-room-header-info">
          <h2 id="currentRoomName">채팅방 이름</h2>
        </div>
        <div class="chat-room-header-actions">
          <button id="chatInfoBtn" class="action-btn">
            <i class="fas fa-info-circle"></i>
          </button>
        </div>
      </div>

      <!-- 메시지 표시 영역 -->
      <div id="messagesContainer" class="messages-container">
        <!-- 메시지는 JavaScript로 동적 추가됨 -->
      </div>

      <!-- 메시지 입력 영역 -->
      <div class="message-input-container">
        <textarea id="messageInput" placeholder="메시지를 입력하세요..." rows="1"></textarea>
        <div class="message-input-actions">
          <button id="attachBtn" class="action-btn">
            <i class="fas fa-paperclip"></i>
          </button>
          <button id="sendMessageBtn" class="send-btn">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 새 채팅 모달 -->
<div id="newChatModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>새 채팅</h2>
      <span id="closeNewChatModal" class="close">&times;</span>
    </div>
    <div class="modal-body">
      <div class="search-input-container">
        <input type="text" id="userSearchInput" placeholder="대화할 상대방 검색">
        <i class="fas fa-search"></i>
      </div>
      <div id="searchResults" class="search-results">
        <!-- 검색 결과는 JavaScript로 동적 추가됨 -->
      </div>
    </div>
  </div>
</div>

<!-- 채팅방 정보 모달 -->
<div id="chatInfoModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>채팅방 정보</h2>
      <span id="closeChatInfoModal" class="close">&times;</span>
    </div>
    <div class="modal-body">
      <div id="chatRoomDetails">
        <!-- 채팅방 정보는 JavaScript로 동적 추가됨 -->
      </div>
    </div>
  </div>
</div>


<!-- STOMP, SockJS 라이브러리 추가 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/ko.min.js"></script>

<!-- 채팅 관련 JavaScript -->
<script th:src="@{/js/chat.js}"></script>
<script th:inline="javascript">
  /*<![CDATA[*/
  let loginMember = /*[[${loginMember}]]*/ {};
  /*]]>*/
</script>
</body>
</html>