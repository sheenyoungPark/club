<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>μ°μ£ΌμΈ μ ν• κ²°κ³Ό</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" th:href="@{/css/result.css}">
    <script th:src="@{/js/top.js}"></script>
</head>
<body th:style="|background-image: url('@{/sources/picture/μ°μ£Όλ°°κ²½.png}');
                 background-size: cover;
                 background-repeat: no-repeat;
                 background-position: center;
                 background-attachment: fixed;|">

<!-- λ΅κ³ λ§ μ¶”κ°€ -->
<a th:href="@{/}" class="logo-container" style="position: fixed; top: 20px; left: 60px; z-index: 1000; display: flex; align-items: center; height: 60px;">
    <img th:src="@{/sources/picture/μ°μ£Όλ™λ΅κ³ .png}" alt="μ°μ£Όλ™ λ΅κ³ " class="logo-img">
    <div class="logo-hover-text">
        <div><span class="first-letter">μ°</span>λ¦¬</div>
        <div><span class="first-letter">μ£Ό</span>λ³€μ</div>
        <div><span class="first-letter">λ™</span>νΈν</div>
    </div>
</a>

<!--<div th:replace="~{include/top_search :: top_search}"></div>-->
<div class="result-container">
    <div class="result-header">
        <h1>μ°μ£Όλ™ μ ν• κ²°κ³Ό</h1>
        <br>
        <h2>π€ μ°μ£Όλ™ | μ„±κ²© μ ν•λ³„ μ¶”μ² λ™νΈν ν™λ™ π</h2>
        <h4>"λ‹Ήμ‹ μ μ„±κ²© μ ν•μ— λ”°λΌ κ°€μ¥ μ λ§λ” λ™νΈν ν™λ™μ„ μ¶”μ²ν•΄ λ“λ ¤μ”!"</h4>

        <div class="result-type">
            λ‹Ήμ‹ μ€ γ€<span th:text="${topResultType}"></span>γ€ μ ν•μ…λ‹λ‹¤!
        </div>

        <div class="result-planet" th:text="${resultPlanet}">
        </div>
        <div class="result-planet-image">
            <img th:src="@{'/sources/picture/' + ${resultPlanet} + '.png'}" alt="ν–‰μ„± μ΄λ―Έμ§€" style="max-width: 300px; margin-top: 10px;" />
        </div>

        <div class="result-description" th:text="${resultDescription}">
        </div>
    </div>

    <div class="chart-container">
        <canvas id="resultChart"></canvas>
    </div>

    <div class="activities-section">
        <h2>μ¶”μ² ν™λ™ (<span th:text="${resultCategories}"></span>)</h2>
        <div th:each="activity : ${resultActivities}">
            <div class="activities-category" th:text="${activity.category}"></div>
            <ul class="activities-list">
                <li th:each="example : ${activity.examples}" th:text="${example}"></li>
            </ul>
        </div>
    </div>

    <div class="roles-section">
        <h2>λ‹Ήμ‹ μ μ—­ν• </h2>
        <ul>
            <li th:each="role : ${resultRoles}" th:text="${role}"></li>
        </ul>
    </div>

    <div class="companion-section">
        <h2 class="companion-header">μµκ³ μ λ™λ°μ: <span th:text="${resultGoodCompanion}"></span></h2>
        <p><strong><span th:text="${companionType}"></span> - <span th:text="${companionPlanet}"></span></strong></p>
        <p th:text="${companionDescription}"></p>
    </div>

    <a th:href="@{/survey/start}" class="btn-restart">λ‹¤μ‹ ν…μ¤νΈν•κΈ°</a>
    <!-- κ²°κ³Ό μ €μ¥ λ²„νΌ -->
    <button type="button" class="btn-restart" onclick="saveSurveyResult()">λ‚΄ κ²°κ³Ό μ €μ¥</button>
    <!-- λ΅κ·ΈμΈ μ—¬λ¶€λ¥Ό Thymeleafμ—μ„ JS λ³€μλ΅ μ „λ‹¬ -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        const isLogin = /*[[${loginMember != null && loginMember.login}]]*/ false;
        const saveUrl = /*[[@{/survey/save(Type=${topResultType})}]]*/ "";
        /*]]>*/

        function saveSurveyResult() {
            if (!isLogin) {
                alert('λ΅κ·ΈμΈ ν›„ λ‹¤μ‹ μ§„ν–‰ν•΄μ£Όμ„Έμ”.');
                location.href = '/member/login';
            } else {
                location.href = saveUrl;
            }
        }
    </script>
</div>

<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function() {
        // μ°¨νΈ λ°μ΄ν„°
        const resultCounts = /*[[${typeCount}]]*/ {};

        // μ°¨νΈ λ°μ΄ν„°κ°€ μ—†λ” κ²½μ°μ— λ€ν• μ²λ¦¬
        if (Object.keys(resultCounts).length === 0) {
            // κΈ°λ³Έκ°’ μ„¤μ •
            const defaultTypes = ["νƒν—κ°€", "κµλ¥κ°€", "λ¶„μ„κ°€", "κ΄€λ¦¬μ"];
            const topResultType = /*[[${topResultType}]]*/ "νƒν—κ°€";
            defaultTypes.forEach(type => {
                resultCounts[type] = type === topResultType ? 5 : Math.floor(Math.random() * 3) + 1;
            });
        }

        // μ°¨νΈ κ·Έλ¦¬κΈ°
        const ctx = document.getElementById('resultChart').getContext('2d');
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: Object.keys(resultCounts),
                datasets: [{
                    label: 'μ ν• λ¶„ν¬',
                    data: Object.values(resultCounts),
                    backgroundColor: '#f0ffdd',
                    borderColor: '#9cee69',
                    pointBackgroundColor: '#9cee69',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: '#9cee69'
                }]
            },
            options: {
                elements: {
                    line: {
                        borderWidth: 3
                    }
                },
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 0,
                        suggestedMax: 12  // μµλ€κ°’μ„ 12λ΅ κ³ μ •
                    }
                }
            }
        });
    });
    /*]]>*/
</script>
<!--<div th:replace="~{include/bottom_info :: bottom_info}"></div>-->
</body>
</html>